<div class="app-container">
  <header class="app-header">
    <h1>TaskMaster</h1>
    <nav class="nav-menu">
      <button class="nav-btn" (click)="currentView = 'login'" [class.active]="currentView === 'login'">Login</button>
      <button class="nav-btn" (click)="currentView = 'tasks'" [class.active]="currentView === 'tasks'">Tasks</button>
      <button class="nav-btn" (click)="currentView = 'profile'" [class.active]="currentView === 'profile'">Profile</button>
    </nav>
  </header>

  <main class="app-main">
    <div class="container">
      @if (currentView === 'login') {
        <div class="auth-section">
          <div class="auth-card">
            <h2>Welcome to TaskMaster</h2>
            <form (ngSubmit)="login()" #loginForm="ngForm">
              <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" [(ngModel)]="user.username" name="username" required>
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" [(ngModel)]="user.email" name="email" required>
              </div>
              <button type="submit" class="btn btn-primary" [disabled]="!loginForm.form.valid">Login</button>
            </form>
          </div>
        </div>
      }

      @if (currentView === 'tasks') {
        <div class="tasks-section">
          <div class="tasks-header">
            <h2>My Tasks</h2>
            <button class="btn btn-primary" (click)="showAddTask = !showAddTask">
              {{ showAddTask ? 'Cancel' : 'Add New Task' }}
            </button>
          </div>

          @if (showAddTask) {
            <div class="add-task-form">
              <h3>Create New Task</h3>
              <form (ngSubmit)="addTask()" #taskForm="ngForm">
                <div class="form-row">
                  <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" id="title" [(ngModel)]="newTask.title" name="title" required>
                  </div>
                  <div class="form-group">
                    <label for="priority">Priority</label>
                    <select id="priority" [(ngModel)]="newTask.priority" name="priority">
                      <option value="low">Low</option>
                      <option value="medium">Medium</option>
                      <option value="high">High</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="description">Description</label>
                  <textarea id="description" [(ngModel)]="newTask.description" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label for="dueDate">Due Date</label>
                  <input type="date" id="dueDate" [(ngModel)]="newTask.dueDate" name="dueDate">
                </div>
                <button type="submit" class="btn btn-success" [disabled]="!taskForm.form.valid">Add Task</button>
              </form>
            </div>
          }

          <div class="tasks-grid">
            @for (task of filteredTasks; track task.id) {
              <div class="task-card" [class]="'priority-' + task.priority">
                <div class="task-header">
                  <h3>{{ task.title }}</h3>
                  <span class="priority-badge" [class]="'priority-' + task.priority">{{ task.priority }}</span>
                </div>
                <p class="task-description">{{ task.description }}</p>
                <div class="task-meta">
                  <span class="due-date">Due: {{ task.dueDate | date:'shortDate' }}</span>
                  <span class="status" [class]="'status-' + task.status">{{ task.status }}</span>
                </div>
                <div class="task-actions">
                  <button class="btn btn-sm btn-success" (click)="toggleTaskStatus(task)"
                          [disabled]="task.status === 'completed'">
                    {{ task.status === 'completed' ? 'Completed' : 'Mark Complete' }}
                  </button>
                  <button class="btn btn-sm btn-warning" (click)="editTask(task)">Edit</button>
                  <button class="btn btn-sm btn-danger" (click)="deleteTask(task.id)">Delete</button>
                </div>
              </div>
            }
          </div>

          @if (tasks.length === 0) {
            <div class="empty-state">
              <h3>No tasks yet!</h3>
              <p>Create your first task to get started.</p>
            </div>
          }
        </div>
      }

      @if (currentView === 'profile') {
        <div class="profile-section">
          <div class="profile-card">
            <h2>User Profile</h2>
            <div class="profile-info">
              <div class="avatar">{{ user.username?.charAt(0).toUpperCase() }}</div>
              <div class="user-details">
                <h3>{{ user.username }}</h3>
                <p>{{ user.email }}</p>
              </div>
            </div>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-number">{{ getTotalTasks() }}</span>
                <span class="stat-label">Total Tasks</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getCompletedTasks() }}</span>
                <span class="stat-label">Completed</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getPendingTasks() }}</span>
                <span class="stat-label">Pending</span>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </main>
</div>

<router-outlet />