<div class="animate-fade-in">
  <!-- Page Header -->
  <div class="content-header mb-6">
    <div class="breadcrumb">
      <span>Members</span>
      <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
      <span class="breadcrumb-active">Member Details</span>
    </div>
    <h1 class="text-page-title">Member Management</h1>
    <p class="text-body text-gray-600 dark:text-gray-400">Manage member information and settings</p>
  </div>

  <!-- Action Bar -->
  <div class="mb-6 flex justify-between items-center">
    <div class="flex items-center gap-4">
      <mat-form-field appearance="outline" class="w-80">
        <mat-label>Search members...</mat-label>
        <input matInput [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Search by name, member no, or mobile">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
    <button mat-raised-button color="primary" class="btn btn-primary" (click)="openOffCanvas('create')">
      <mat-icon>add</mat-icon>
      Create Member
    </button>
  </div>

  <!-- Members Table -->
  <mat-card class="card">
    <div class="card-header bg-gradient-to-r from-blue-600 to-purple-600">
      <div class="card-title">
        <mat-icon>people</mat-icon>
        <span>Members List</span>
      </div>
    </div>

    <mat-card-content class="p-0">
      <div class="overflow-x-auto">
        <table mat-table [dataSource]="dataSource" class="w-full">

          <!-- Member No Column -->
          <ng-container matColumnDef="memberNo">
            <th mat-header-cell *matHeaderCellDef class="font-semibold">Member No</th>
            <td mat-cell *matCellDef="let element" class="text-body font-medium">{{element.memberNo}}</td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef class="font-semibold">Full Name</th>
            <td mat-cell *matCellDef="let element" class="text-body font-medium">
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                  <span class="text-blue-600 font-medium text-sm">{{element.name.charAt(0)}}</span>
                </div>
                <span>{{element.name}}</span>
              </div>
            </td>
          </ng-container>

          <!-- Mobile Column -->
          <ng-container matColumnDef="mobile">
            <th mat-header-cell *matHeaderCellDef class="font-semibold">Mobile</th>
            <td mat-cell *matCellDef="let element" class="text-body">{{element.mobile || 'N/A'}}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef class="font-semibold">Status</th>
            <td mat-cell *matCellDef="let element" class="text-body">
              <span class="px-2 py-1 rounded-full text-xs font-medium"
                    [class]="element.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                {{element.status}}
              </span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="font-semibold">Actions</th>
            <td mat-cell *matCellDef="let element" class="text-body">
              <div class="flex gap-2">
                <button mat-icon-button color="primary" matTooltip="View" (click)="onView(element)">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button color="accent" matTooltip="Edit" (click)="onEdit(element)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" matTooltip="Delete" (click)="onDelete(element)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>
        </table>

        <!-- No data message -->
        <div *ngIf="dataSource.data.length === 0" class="text-center py-8">
          <mat-icon class="text-gray-400 text-6xl mb-4">person_off</mat-icon>
          <h3 class="text-lg font-medium text-gray-600 mb-2">No Members Found</h3>
          <p class="text-gray-400 mb-4">Get started by creating your first member</p>
          <button mat-raised-button color="primary" (click)="openOffCanvas('create')">
            <mat-icon>add</mat-icon>
            Create Member
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<!-- Off-canvas Overlay -->
<div class="off-canvas-overlay" [class.active]="isOffCanvasOpen()" (click)="closeOffCanvas()"></div>

<!-- Off-canvas Form -->
<div class="off-canvas" [class.active]="isOffCanvasOpen()">
  <div class="off-canvas-header">
    <h2 class="text-xl font-semibold text-white">
      <mat-icon class="mr-2">{{isEditMode() ? 'edit' : 'person_add'}}</mat-icon>
      {{isEditMode() ? 'Edit Member' : 'Create New Member'}}
    </h2>
    <button mat-icon-button (click)="closeOffCanvas()" class="text-white">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="memberForm" (ngSubmit)="onSubmit()" class="off-canvas-content">
    <mat-tab-group class="member-form-tabs">
      <!-- Personal Details Tab -->
      <mat-tab label="Personal Details">
        <div class="form-section p-6">
          <div class="form-grid form-grid-2">
            <mat-form-field appearance="outline">
              <mat-label>Member Number *</mat-label>
              <input matInput formControlName="memberNo" required>
              <mat-error *ngIf="memberForm.get('memberNo')?.hasError('required')">
                Member number is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Full Name *</mat-label>
              <input matInput formControlName="name" required>
              <mat-error *ngIf="memberForm.get('name')?.hasError('required')">
                Name is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Father/Husband Name *</mat-label>
              <input matInput formControlName="fhName" required>
              <mat-error *ngIf="memberForm.get('fhName')?.hasError('required')">
                Father/Husband name is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date of Birth</mat-label>
              <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth">
              <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
              <mat-datepicker #dobPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Mobile</mat-label>
              <input matInput formControlName="mobile" maxlength="10">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email">
              <mat-error *ngIf="memberForm.get('email')?.hasError('email')">
                Please enter a valid email
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>City</mat-label>
              <input matInput formControlName="city">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Status</mat-label>
              <mat-select formControlName="status">
                <mat-option value="Active">Active</mat-option>
                <mat-option value="Inactive">Inactive</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-section mt-6">
            <h3 class="text-lg font-medium mb-4">Address Information</h3>
            <div class="form-grid form-grid-1">
              <mat-form-field appearance="outline">
                <mat-label>Office Address</mat-label>
                <textarea matInput formControlName="officeAddress" rows="3"></textarea>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Residence Address</mat-label>
                <textarea matInput formControlName="residenceAddress" rows="3"></textarea>
              </mat-form-field>
            </div>
          </div>
        </div>
      </mat-tab>

      <!-- Professional Details Tab -->
      <mat-tab label="Professional">
        <div class="form-section p-6">
          <div class="form-grid form-grid-2">
            <mat-form-field appearance="outline">
              <mat-label>Designation</mat-label>
              <input matInput formControlName="designation">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Branch</mat-label>
              <input matInput formControlName="branch">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date of Joining Job</mat-label>
              <input matInput [matDatepicker]="dojJobPicker" formControlName="dojJob">
              <mat-datepicker-toggle matSuffix [for]="dojJobPicker"></mat-datepicker-toggle>
              <mat-datepicker #dojJobPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date of Retirement</mat-label>
              <input matInput [matDatepicker]="doRetirementPicker" formControlName="doRetirement">
              <mat-datepicker-toggle matSuffix [for]="doRetirementPicker"></mat-datepicker-toggle>
              <mat-datepicker #doRetirementPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date of Joining Society</mat-label>
              <input matInput [matDatepicker]="dojSocietyPicker" formControlName="dojSociety">
              <mat-datepicker-toggle matSuffix [for]="dojSocietyPicker"></mat-datepicker-toggle>
              <mat-datepicker #dojSocietyPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Phone Office</mat-label>
              <input matInput formControlName="phoneOffice">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Phone Residence</mat-label>
              <input matInput formControlName="phoneResidence">
            </mat-form-field>
          </div>
        </div>
      </mat-tab>

      <!-- Financial Details Tab -->
      <mat-tab label="Financial">
        <div class="form-section p-6">
          <div class="form-grid form-grid-2">
            <mat-form-field appearance="outline">
              <mat-label>Share Amount</mat-label>
              <input matInput formControlName="shareAmount" type="number" min="0">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>CD Amount</mat-label>
              <input matInput formControlName="cdAmount" type="number" min="0">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Bank Name</mat-label>
              <input matInput formControlName="bankName">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Payable At</mat-label>
              <input matInput formControlName="payableAt">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Account Number</mat-label>
              <input matInput formControlName="accountNo">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Share Deduction</mat-label>
              <input matInput formControlName="shareDeduction" type="number" min="0">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Withdrawal</mat-label>
              <input matInput formControlName="withdrawal" type="number" min="0">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>G-Loan Instalment</mat-label>
              <input matInput formControlName="gLoanInstalment" type="number" min="0">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>E-Loan Instalment</mat-label>
              <input matInput formControlName="eLoanInstalment" type="number" min="0">
            </mat-form-field>
          </div>
        </div>
      </mat-tab>

      <!-- Nominee Details Tab -->
      <mat-tab label="Nominee">
        <div class="form-section p-6">
          <div class="form-grid form-grid-2">
            <mat-form-field appearance="outline">
              <mat-label>Nominee Name</mat-label>
              <input matInput formControlName="nominee">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Nominee Relation</mat-label>
              <mat-select formControlName="nomineeRelation">
                <mat-option value="Spouse">Spouse</mat-option>
                <mat-option value="Son">Son</mat-option>
                <mat-option value="Daughter">Daughter</mat-option>
                <mat-option value="Father">Father</mat-option>
                <mat-option value="Mother">Mother</mat-option>
                <mat-option value="Brother">Brother</mat-option>
                <mat-option value="Sister">Sister</mat-option>
                <mat-option value="Other">Other</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>

    <div class="off-canvas-footer">
      <div class="flex gap-3 justify-end">
        <button mat-stroked-button type="button" (click)="closeOffCanvas()">
          <mat-icon>close</mat-icon>
          Cancel
        </button>
        <button mat-raised-button color="primary" type="submit" [disabled]="memberForm.invalid || isSubmitting()">
          <mat-icon>{{isEditMode() ? 'save' : 'add'}}</mat-icon>
          {{isEditMode() ? 'Update Member' : 'Create Member'}}
        </button>
      </div>
    </div>
  </form>
</div>